<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floortype Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
<style>
:root{
  --white:#FFF;--off-white:#F7F5FF;
  --purple:#C4B5F4;--purple-mid:#9B87E8;--purple-deep:#6B56C8;--purple-bg:#EDE9FF;
  --mint:#A8E8DA;--mint-mid:#5DCFB8;--mint-deep:#2BA892;--mint-bg:#DFF6F1;
  --dark:#120F2A;--mid:#3D3660;--muted:#8880AA;--border:#E8E4FF;
  --amber:#FFF3E0;--amber-c:#C07000;--error:#E85555;--sidebar-w:252px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--off-white);color:var(--dark);font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;}
.sidebar{width:var(--sidebar-w);background:var(--dark);min-height:100vh;padding:24px 16px;position:fixed;top:0;left:0;bottom:0;display:flex;flex-direction:column;z-index:10;}
.s-logo{font-family:'Bebas Neue',sans-serif;font-size:21px;letter-spacing:0.12em;color:white;text-decoration:none;display:flex;align-items:center;gap:8px;margin-bottom:3px;}
.logo-mark{width:26px;height:26px;background:linear-gradient(135deg,var(--purple),var(--mint));border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.logo-mark svg{width:13px;height:13px;}
.s-sub{font-size:10px;letter-spacing:0.1em;text-transform:uppercase;color:rgba(255,255,255,0.22);margin-bottom:28px;margin-left:34px;}
.s-sec{font-size:10px;letter-spacing:0.14em;text-transform:uppercase;color:rgba(255,255,255,0.2);margin:18px 0 5px 10px;font-weight:600;}
.nav-item{display:flex;align-items:center;gap:9px;padding:9px 10px;border-radius:9px;color:rgba(255,255,255,0.45);font-size:13px;font-weight:500;transition:all 0.2s;margin-bottom:1px;cursor:pointer;border:none;background:none;width:100%;text-align:left;font-family:'DM Sans',sans-serif;}
.nav-item:hover{background:rgba(255,255,255,0.07);color:rgba(255,255,255,0.85);}
.nav-item.active{background:var(--purple-deep);color:white;}
.nav-item svg{width:15px;height:15px;flex-shrink:0;}
.n-count{margin-left:auto;font-size:11px;font-weight:700;padding:1px 7px;border-radius:100px;min-width:20px;text-align:center;}
.n-alert{background:var(--error);color:white;} .n-new{background:var(--purple);color:var(--dark);}
.s-bottom{margin-top:auto;border-top:1px solid rgba(255,255,255,0.07);padding-top:14px;display:flex;align-items:center;gap:9px;padding:14px 10px 0;}
.s-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--mint));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:14px;color:white;flex-shrink:0;}
.s-name{font-size:12px;font-weight:600;color:rgba(255,255,255,0.65);} .s-role{font-size:10px;color:rgba(255,255,255,0.28);margin-top:1px;}
.main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;min-height:100vh;}
.topbar{background:white;border-bottom:1px solid var(--border);padding:0 28px;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:5;}
.tb-title{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:0.06em;color:var(--dark);}
.tb-sub{font-size:12px;color:var(--muted);margin-top:1px;}
.tb-right{display:flex;align-items:center;gap:10px;}
.tb-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 18px;border-radius:100px;font-size:12px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all 0.2s;text-decoration:none;border:none;}
.tb-primary{background:var(--dark);color:white;} .tb-primary:hover{background:var(--purple-deep);}
.tb-ghost{background:white;color:var(--mid);border:1.5px solid var(--border);} .tb-ghost:hover{border-color:var(--purple-mid);}
.tb-icon-btn{width:36px;height:36px;border-radius:50%;border:1.5px solid var(--border);background:white;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:border-color 0.2s;}
.tb-icon-btn:hover{border-color:var(--purple-mid);} .tb-icon-btn svg{width:16px;height:16px;color:var(--muted);}
.content{padding:28px;flex:1;}
.view{display:none;} .view.active{display:block;}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px;}
.stat-card{background:white;border-radius:14px;border:1px solid var(--border);padding:20px;box-shadow:0 2px 8px rgba(107,86,200,0.05);}
.stat-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px;}
.stat-ico{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;}
.ico-p{background:var(--purple-bg);} .ico-m{background:var(--mint-bg);} .ico-a{background:var(--amber);} .ico-d{background:rgba(18,15,42,0.06);}
.stat-ico svg{width:17px;height:17px;}
.stat-change{font-size:11px;font-weight:600;padding:2px 8px;border-radius:100px;}
.sc-up{background:var(--mint-bg);color:var(--mint-deep);} .sc-new{background:var(--purple-bg);color:var(--purple-deep);}
.stat-num{font-family:'Bebas Neue',sans-serif;font-size:38px;letter-spacing:0.02em;line-height:1;color:var(--dark);}
.stat-num.p{color:var(--purple-deep);} .stat-num.m{color:var(--mint-deep);} .stat-num.a{color:var(--amber-c);}
.stat-lbl{font-size:12px;color:var(--muted);margin-top:4px;font-weight:500;}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px;flex-wrap:wrap;}
.sec-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:0.06em;color:var(--dark);}
.sec-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.search-wrap{position:relative;}
.search-wrap svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:var(--muted);pointer-events:none;}
.search-in{padding:8px 13px 8px 33px;border:1.5px solid var(--border);border-radius:100px;font-size:13px;font-family:'DM Sans',sans-serif;color:var(--dark);background:white;outline:none;width:220px;transition:border-color 0.2s;}
.search-in:focus{border-color:var(--purple-mid);}
.fpill{padding:7px 14px;border-radius:100px;border:1.5px solid var(--border);background:white;font-size:12px;font-weight:500;color:var(--muted);cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;white-space:nowrap;}
.fpill:hover{border-color:var(--purple-mid);color:var(--dark);} .fpill.active{background:var(--purple-deep);border-color:var(--purple-deep);color:white;}
.tbl-wrap{background:white;border-radius:14px;border:1px solid var(--border);overflow:hidden;box-shadow:0 2px 8px rgba(107,86,200,0.05);}
table{width:100%;border-collapse:collapse;}
thead{background:var(--off-white);border-bottom:1px solid var(--border);}
th{padding:10px 16px;text-align:left;font-size:10px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);white-space:nowrap;}
td{padding:14px 16px;border-bottom:1px solid var(--border);font-size:13px;vertical-align:middle;}
tr:last-child td{border-bottom:none;} tbody tr{transition:background 0.15s;cursor:pointer;} tbody tr:hover td{background:var(--off-white);}
.td-ref{font-weight:700;color:var(--purple-deep);font-size:12px;letter-spacing:0.04em;}
.td-name{font-weight:600;color:var(--dark);} .td-sub{font-size:11px;color:var(--muted);margin-top:2px;} .td-muted{color:var(--muted);font-size:12px;}
.td-amt{font-weight:600;color:var(--dark);} .td-amt .sub{font-size:11px;color:var(--muted);font-weight:400;}
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;white-space:nowrap;}
.badge::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.b-recv{background:#E8F4FF;color:#1A6FAF;} .b-recv::before{background:#1A6FAF;}
.b-prog{background:var(--amber);color:var(--amber-c);} .b-prog::before{background:var(--amber-c);}
.b-rev{background:var(--purple-bg);color:var(--purple-deep);} .b-rev::before{background:var(--purple-deep);}
.b-done{background:var(--mint-bg);color:var(--mint-deep);} .b-done::before{background:var(--mint-deep);}
.b-new{background:var(--purple-bg);color:var(--purple-deep);} .b-new::before{background:var(--purple-deep);}
.b-qtd{background:#E8F4FF;color:#1A6FAF;} .b-qtd::before{background:#1A6FAF;}
.b-appr{background:var(--mint-bg);color:var(--mint-deep);} .b-appr::before{background:var(--mint-deep);}
.b-hold{background:#F5F5F5;color:#888;} .b-hold::before{background:#888;}
.b-inv{background:#FFF8E1;color:#B07D00;} .b-inv::before{background:#B07D00;}
.row-btn{background:none;border:1.5px solid var(--border);border-radius:7px;padding:5px 12px;font-size:11px;font-weight:600;color:var(--mid);cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;white-space:nowrap;}
.row-btn:hover{border-color:var(--purple-mid);color:var(--purple-deep);background:var(--purple-bg);}
.ov-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
.ov-card{background:white;border-radius:14px;border:1px solid var(--border);padding:20px;box-shadow:0 2px 8px rgba(107,86,200,0.05);}
.ov-card-title{font-size:11px;font-weight:700;letter-spacing:0.12em;text-transform:uppercase;color:var(--muted);margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;}
.ov-see-all{font-size:12px;color:var(--purple-deep);cursor:pointer;font-weight:500;letter-spacing:0;text-transform:none;}
.ov-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);cursor:pointer;}
.ov-item:hover .ov-name{color:var(--purple-deep);} .ov-item:last-child{border-bottom:none;}
.ov-ico{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.ovi-p{background:var(--purple-bg);} .ovi-m{background:var(--mint-bg);}
.ov-info{flex:1;min-width:0;}
.ov-name{font-size:13px;font-weight:600;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color 0.2s;}
.ov-sub{font-size:11px;color:var(--muted);margin-top:1px;}
.ov-right{flex-shrink:0;text-align:right;}
.ov-amt{font-size:13px;font-weight:600;color:var(--dark);} .ov-date{font-size:11px;color:var(--muted);margin-top:2px;}
.rev-card{background:white;border-radius:14px;border:1px solid var(--border);padding:20px;box-shadow:0 2px 8px rgba(107,86,200,0.05);}
.rev-total{font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:0.04em;color:var(--dark);margin-bottom:2px;}
.rev-sub{font-size:12px;color:var(--muted);margin-bottom:12px;}
.rev-chart{display:flex;align-items:flex-end;gap:6px;height:72px;}
.rev-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;}
.rev-bar{width:100%;border-radius:4px 4px 0 0;background:var(--purple-bg);min-height:4px;}
.rev-bar.cur{background:linear-gradient(to top,var(--purple-deep),var(--purple-mid));}
.rev-lbl{font-size:9px;color:var(--muted);}
.clients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;}
.cc{background:white;border-radius:14px;border:1px solid var(--border);padding:20px;box-shadow:0 2px 8px rgba(107,86,200,0.05);cursor:pointer;transition:all 0.2s;}
.cc:hover{border-color:var(--purple-mid);transform:translateY(-2px);box-shadow:0 8px 24px rgba(107,86,200,0.1);}
.cc-top{display:flex;align-items:center;gap:12px;margin-bottom:14px;}
.cc-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--mint));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:18px;color:white;flex-shrink:0;}
.cc-name{font-size:14px;font-weight:700;color:var(--dark);} .cc-co{font-size:12px;color:var(--muted);margin-top:2px;}
.cc-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
.cc-stat{background:var(--off-white);border-radius:8px;padding:9px;border:1px solid var(--border);text-align:center;}
.cc-stat-num{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:0.04em;color:var(--dark);}
.cc-stat-lbl{font-size:10px;color:var(--muted);margin-top:1px;}
.settings-layout{display:grid;grid-template-columns:200px 1fr;gap:20px;align-items:start;}
.settings-nav-card{background:white;border-radius:14px;border:1px solid var(--border);padding:10px;}
.sn-item{padding:9px 12px;border-radius:8px;font-size:13px;font-weight:500;color:var(--muted);cursor:pointer;transition:all 0.2s;margin-bottom:1px;}
.sn-item:hover{background:var(--purple-bg);color:var(--purple-deep);} .sn-item.active{background:var(--purple-bg);color:var(--purple-deep);font-weight:600;}
.settings-panel{background:white;border-radius:14px;border:1px solid var(--border);padding:28px;}
.sp-title{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:0.04em;color:var(--dark);margin-bottom:4px;}
.sp-sub{font-size:13px;color:var(--muted);margin-bottom:24px;font-weight:300;line-height:1.6;}
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:15px 0;border-bottom:1px solid var(--border);gap:20px;}
.setting-row:last-of-type{border-bottom:none;}
.sr-label{font-size:14px;font-weight:600;color:var(--dark);} .sr-desc{font-size:12px;color:var(--muted);margin-top:3px;line-height:1.5;}
.s-input{padding:9px 13px;border:1.5px solid var(--border);border-radius:9px;font-size:13px;font-family:'DM Sans',sans-serif;color:var(--dark);outline:none;width:200px;transition:border-color 0.2s;}
.s-input:focus{border-color:var(--purple-mid);}
.toggle{width:42px;height:24px;background:var(--border);border-radius:100px;position:relative;cursor:pointer;transition:background 0.3s;flex-shrink:0;border:none;}
.toggle.on{background:var(--mint-deep);}
.toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:white;top:3px;left:3px;transition:transform 0.3s;box-shadow:0 1px 4px rgba(0,0,0,0.15);}
.toggle.on::after{transform:translateX(18px);}
.pricing-table{width:100%;border-collapse:collapse;}
.pricing-table th{padding:9px 12px;text-align:left;font-size:10px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);background:var(--off-white);border-bottom:1px solid var(--border);}
.pricing-table td{padding:11px 12px;border-bottom:1px solid var(--border);font-size:13px;}
.pricing-table tr:last-child td{border-bottom:none;}
.p-input{width:90px;padding:7px 10px;border:1.5px solid var(--border);border-radius:7px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;color:var(--dark);outline:none;text-align:center;}
.p-input:focus{border-color:var(--purple-mid);}
.overlay{position:fixed;inset:0;background:rgba(18,15,42,0.5);backdrop-filter:blur(4px);z-index:100;display:none;align-items:center;justify-content:center;padding:24px;}
.overlay.show{display:flex;}
.modal{background:white;border-radius:20px;width:100%;max-width:660px;max-height:90vh;overflow-y:auto;box-shadow:0 32px 80px rgba(18,15,42,0.3);}
.m-header{padding:22px 28px 16px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;position:sticky;top:0;background:white;border-radius:20px 20px 0 0;z-index:1;}
.m-ref{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:0.06em;color:var(--purple-deep);}
.m-tag{font-size:11px;font-weight:600;color:var(--muted);margin-top:3px;}
.m-close{width:30px;height:30px;border-radius:50%;border:1.5px solid var(--border);background:none;font-size:17px;cursor:pointer;color:var(--muted);display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.m-close:hover{background:#FFE8E8;color:var(--error);border-color:#FFE8E8;}
.m-body{padding:22px 28px;}
.m-sec{margin-bottom:22px;}
.m-sec-title{font-size:10px;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;color:var(--muted);margin-bottom:10px;display:flex;align-items:center;gap:8px;}
.m-sec-title::after{content:'';flex:1;height:1px;background:var(--border);}
.d-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.d-item{background:var(--off-white);border-radius:9px;padding:11px 13px;border:1px solid var(--border);}
.d-item.full{grid-column:1/-1;}
.d-lbl{font-size:10px;color:var(--muted);letter-spacing:0.06em;text-transform:uppercase;margin-bottom:3px;}
.d-val{font-size:13px;font-weight:500;color:var(--dark);line-height:1.5;}
.d-val.p{color:var(--purple-deep);} .d-val.m{color:var(--mint-deep);}
.r-tags{display:flex;flex-wrap:wrap;gap:5px;}
.r-tag{background:var(--purple-bg);color:var(--purple-deep);font-size:11px;font-weight:600;padding:3px 10px;border-radius:100px;}
.m-notes{background:var(--off-white);border-radius:9px;padding:13px;border:1px solid var(--border);font-size:13px;color:var(--mid);line-height:1.65;}
.f-list{display:flex;flex-direction:column;gap:6px;}
.f-row{display:flex;align-items:center;gap:8px;background:var(--off-white);border-radius:8px;padding:8px 12px;border:1px solid var(--border);}
.f-ext{background:var(--purple-bg);color:var(--purple-deep);font-size:9px;font-weight:700;padding:2px 7px;border-radius:4px;letter-spacing:0.04em;}
.f-name{flex:1;font-size:12px;font-weight:500;color:var(--dark);}
.f-dl{background:none;border:1.5px solid var(--border);border-radius:6px;padding:3px 10px;font-size:11px;font-weight:600;color:var(--purple-deep);cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;}
.f-dl:hover{background:var(--purple-bg);}
.status-select{width:100%;border:1.5px solid var(--border);border-radius:9px;padding:9px 13px;font-size:13px;font-family:'DM Sans',sans-serif;color:var(--dark);background:white;outline:none;}
.m-footer{padding:14px 28px 20px;display:flex;gap:8px;justify-content:flex-end;border-top:1px solid var(--border);position:sticky;bottom:0;background:white;border-radius:0 0 20px 20px;}
.btn-save{background:var(--dark);color:white;border:none;padding:9px 24px;border-radius:100px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;transition:background 0.2s;}
.btn-save:hover{background:var(--purple-deep);}
.btn-cancel{background:white;color:var(--dark);border:1.5px solid var(--border);padding:9px 18px;border-radius:100px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;}
.btn-cancel:hover{border-color:var(--purple-mid);}
.btn-convert{background:var(--mint-deep);color:white;border:none;padding:9px 18px;border-radius:100px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;}
.q-editor{background:linear-gradient(135deg,var(--purple-bg),var(--mint-bg));border:1.5px solid var(--purple);border-radius:12px;padding:16px;margin-top:4px;}
.qe-lbl{font-size:10px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--purple-deep);margin-bottom:10px;}
.qe-row{display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end;}
.qe-field label{font-size:11px;color:var(--muted);display:block;margin-bottom:4px;}
.qe-input{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;font-weight:600;font-family:'DM Sans',sans-serif;color:var(--dark);background:white;outline:none;}
.qe-send{background:var(--purple-deep);color:white;border:none;padding:9px 16px;border-radius:8px;font-size:12px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;height:38px;}
.empty-state{text-align:center;padding:52px 24px;}
.empty-ico{width:50px;height:50px;background:var(--purple-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto 14px;}
.empty-ico svg{width:22px;height:22px;color:var(--purple-deep);}
.empty-state h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:0.04em;color:var(--dark);margin-bottom:5px;}
.empty-state p{font-size:13px;color:var(--muted);line-height:1.65;}
.toast{position:fixed;bottom:24px;right:24px;background:var(--dark);color:white;padding:12px 20px;border-radius:10px;font-size:13px;font-weight:500;box-shadow:0 8px 28px rgba(18,15,42,0.2);transform:translateY(70px);opacity:0;transition:all 0.3s ease;z-index:300;}
.toast.show{transform:translateY(0);opacity:1;} .toast.success{background:var(--mint-deep);} .toast.warn{background:var(--amber-c);}
</style>
</head>
<body>
<div class="sidebar">
  <a href="/" class="s-logo">
    <div class="logo-mark"><svg viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="12" rx="1" stroke="white" stroke-width="1.2"/><line x1="2" y1="8" x2="14" y2="8" stroke="white" stroke-width="1.2"/><line x1="8" y1="2" x2="8" y2="14" stroke="white" stroke-width="1.2"/></svg></div>
    FLOORTYPE
  </a>
  <div class="s-sub">Admin Dashboard</div>
  <div class="s-sec">Main</div>
  <button class="nav-item active" id="nav-overview" onclick="showView('overview')">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><rect x="2" y="2" width="5" height="5" rx="1"/><rect x="9" y="2" width="5" height="5" rx="1"/><rect x="2" y="9" width="5" height="5" rx="1"/><rect x="9" y="9" width="5" height="5" rx="1"/></svg>Overview
  </button>
  <button class="nav-item" id="nav-orders" onclick="showView('orders')">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><rect x="2" y="2" width="12" height="12" rx="2"/><line x1="5" y1="6" x2="11" y2="6"/><line x1="5" y1="9" x2="9" y2="9"/></svg>Orders
    <span class="n-count n-alert" id="nc-orders" style="display:none">0</span>
  </button>
  <button class="nav-item" id="nav-quotes" onclick="showView('quotes')">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><path d="M13 10a1 1 0 01-1 1H4l-2 2V4a1 1 0 011-1h9a1 1 0 011 1v6z"/></svg>Quote Requests
    <span class="n-count n-new" id="nc-quotes" style="display:none">0</span>
  </button>
  <button class="nav-item" id="nav-clients" onclick="showView('clients')">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><circle cx="8" cy="5" r="3"/><path d="M2 14c0-3.314 2.686-5 6-5s6 1.686 6 5"/></svg>Clients
  </button>
  <div class="s-sec">Configure</div>
  <button class="nav-item" id="nav-settings" onclick="showView('settings')">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><circle cx="8" cy="8" r="2.5"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41"/></svg>Settings & Pricing
  </button>
  <div class="s-bottom"><div class="s-avatar">A</div><div><div class="s-name">Admin</div><div class="s-role">floortype.com</div></div></div>
</div>
<div class="main">
  <div class="topbar">
    <div><div class="tb-title" id="tb-title">Overview</div><div class="tb-sub" id="tb-sub">Welcome back</div></div>
    <div class="tb-right">
      <div class="tb-icon-btn" onclick="loadData();showToast('Refreshed ✓','')" title="Refresh"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><path d="M13.5 8A5.5 5.5 0 112.5 5"/><polyline points="2.5 2 2.5 5 5.5 5"/></svg></div>
      <button class="tb-btn tb-ghost" onclick="exportCSV()">Export CSV</button>
      <a href="/order" target="_blank" class="tb-btn tb-primary">+ New Order</a>
    </div>
  </div>
  <div class="content">
    <div class="view active" id="view-overview">
      <div class="stats-row">
        <div class="stat-card"><div class="stat-top"><div class="stat-ico ico-p"><svg viewBox="0 0 16 16" fill="none" stroke="var(--purple-deep)" stroke-width="1.3"><rect x="2" y="2" width="12" height="12" rx="2"/><line x1="5" y1="6" x2="11" y2="6"/><line x1="5" y1="9" x2="9" y2="9"/></svg></div><span class="stat-change sc-up" id="s-orders-new">0 new</span></div><div class="stat-num p" id="s-orders">0</div><div class="stat-lbl">Total Orders</div></div>
        <div class="stat-card"><div class="stat-top"><div class="stat-ico ico-a"><svg viewBox="0 0 16 16" fill="none" stroke="var(--amber-c)" stroke-width="1.3"><path d="M13 10a1 1 0 01-1 1H4l-2 2V4a1 1 0 011-1h9a1 1 0 011 1v6z"/></svg></div><span class="stat-change sc-new" id="s-quotes-new">0 new</span></div><div class="stat-num a" id="s-quotes">0</div><div class="stat-lbl">Quote Requests</div></div>
        <div class="stat-card"><div class="stat-top"><div class="stat-ico ico-m"><svg viewBox="0 0 16 16" fill="none" stroke="var(--mint-deep)" stroke-width="1.3"><circle cx="8" cy="8" r="6"/><path d="M5 8l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/></svg></div><span class="stat-change sc-up">delivered</span></div><div class="stat-num m" id="s-complete">0</div><div class="stat-lbl">Completed</div></div>
        <div class="stat-card"><div class="stat-top"><div class="stat-ico ico-d"><svg viewBox="0 0 16 16" fill="none" stroke="var(--mid)" stroke-width="1.3"><path d="M2 12V4l6-2 6 2v8l-6 2-6-2z"/><line x1="8" y1="2" x2="8" y2="14"/></svg></div></div><div class="stat-num" id="s-revenue">$0</div><div class="stat-lbl">Revenue (deposits)</div></div>
      </div>
      <div class="ov-grid">
        <div class="ov-card"><div class="ov-card-title">Recent Orders <span class="ov-see-all" onclick="showView('orders')">See all →</span></div><div id="ov-orders"></div></div>
        <div class="ov-card"><div class="ov-card-title">Recent Quotes <span class="ov-see-all" onclick="showView('quotes')">See all →</span></div><div id="ov-quotes"></div></div>
      </div>
      <div class="rev-card"><div class="rev-total" id="rev-total">$0</div><div class="rev-sub">Deposits collected — last 6 months</div><div class="rev-chart" id="rev-chart"></div></div>
    </div>
    <div class="view" id="view-orders">
      <div class="sec-hdr"><div class="sec-title">All Orders</div><div class="sec-actions"><div class="search-wrap"><svg viewBox="0 0 16 16" fill="none"><circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/><line x1="10" y1="10" x2="14" y2="14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg><input class="search-in" type="text" id="orders-search" placeholder="Search orders…" oninput="renderOrdersTable()"></div><button class="fpill active" data-f="all" onclick="setFilter(this,'orders')">All</button><button class="fpill" data-f="Received" onclick="setFilter(this,'orders')">New</button><button class="fpill" data-f="In Progress" onclick="setFilter(this,'orders')">In Progress</button><button class="fpill" data-f="In Review" onclick="setFilter(this,'orders')">In Review</button><button class="fpill" data-f="Complete" onclick="setFilter(this,'orders')">Complete</button></div></div>
      <div class="tbl-wrap"><table><thead><tr><th>Ref</th><th>Client</th><th>Project</th><th>Status</th><th>Amount</th><th>Date</th><th></th></tr></thead><tbody id="orders-tbody"></tbody></table></div>
    </div>
    <div class="view" id="view-quotes">
      <div class="sec-hdr"><div class="sec-title">Quote Requests</div><div class="sec-actions"><div class="search-wrap"><svg viewBox="0 0 16 16" fill="none"><circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/><line x1="10" y1="10" x2="14" y2="14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg><input class="search-in" type="text" id="quotes-search" placeholder="Search quotes…" oninput="renderQuotesTable()"></div><button class="fpill active" data-f="all" onclick="setFilter(this,'quotes')">All</button><button class="fpill" data-f="Received" onclick="setFilter(this,'quotes')">New</button><button class="fpill" data-f="Quoted" onclick="setFilter(this,'quotes')">Quoted</button><button class="fpill" data-f="Approved" onclick="setFilter(this,'quotes')">Approved</button><button class="fpill" data-f="On Hold" onclick="setFilter(this,'quotes')">On Hold</button></div></div>
      <div class="tbl-wrap"><table><thead><tr><th>Ref</th><th>Client & Company</th><th>Project</th><th>Renderings</th><th>Est. Range</th><th>Status</th><th>Date</th><th></th></tr></thead><tbody id="quotes-tbody"></tbody></table></div>
    </div>
    <div class="view" id="view-clients">
      <div class="sec-hdr"><div class="sec-title">Clients</div><div class="sec-actions"><div class="search-wrap"><svg viewBox="0 0 16 16" fill="none"><circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/><line x1="10" y1="10" x2="14" y2="14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg><input class="search-in" type="text" id="clients-search" placeholder="Search clients…" oninput="renderClients()"></div></div></div>
      <div class="clients-grid" id="clients-grid"></div>
    </div>
    <div class="view" id="view-settings">
      <div class="settings-layout">
        <div class="settings-nav-card"><div class="sn-item active" onclick="showSP('general',this)">General</div><div class="sn-item" onclick="showSP('pricing',this)">Pricing & Rates</div><div class="sn-item" onclick="showSP('notifications',this)">Notifications</div><div class="sn-item" onclick="showSP('integrations',this)">Integrations</div></div>
        <div>
          <div class="settings-panel" id="sp-general">
            <div class="sp-title">General Settings</div><div class="sp-sub">Basic configuration for your Floortype account.</div>
            <div class="setting-row"><div><div class="sr-label">Business Name</div><div class="sr-desc">Shown on invoices and client emails</div></div><input class="s-input" value="Floortype"></div>
            <div class="setting-row"><div><div class="sr-label">Notification Email</div><div class="sr-desc">Where new order and quote alerts go</div></div><input class="s-input" type="email" value="hello@floortype.com"></div>
            <div class="setting-row"><div><div class="sr-label">Floor Plan Turnaround</div><div class="sr-desc">Default shown to clients</div></div><select class="s-input"><option>48 hours</option><option>72 hours</option><option>5 business days</option></select></div>
            <div class="setting-row"><div><div class="sr-label">Deposit Model</div><div class="sr-desc">% charged at floor plan checkout</div></div><select class="s-input"><option>50% deposit</option><option>Full payment upfront</option><option>Pay on delivery</option></select></div>
            <div style="margin-top:20px"><button class="btn-save" onclick="showToast('Settings saved ✓','success')">Save Changes</button></div>
          </div>
          <div class="settings-panel" id="sp-pricing" style="display:none">
            <div class="sp-title">Pricing & Rates</div><div class="sp-sub">Base rates per rendering type and tier. These drive the live estimate on the quote form — update when your vendor pricing is confirmed.</div>
            <table class="pricing-table"><thead><tr><th>Type</th><th>Standard</th><th>Premium</th><th>Luxury</th></tr></thead><tbody>
              <tr><td><strong>Interior</strong> / view</td><td><input class="p-input" type="number" value="299"></td><td><input class="p-input" type="number" value="599"></td><td><input class="p-input" type="number" value="999"></td></tr>
              <tr><td><strong>Exterior</strong> / view</td><td><input class="p-input" type="number" value="349"></td><td><input class="p-input" type="number" value="699"></td><td><input class="p-input" type="number" value="1199"></td></tr>
              <tr><td><strong>Aerial</strong> / view</td><td><input class="p-input" type="number" value="399"></td><td><input class="p-input" type="number" value="799"></td><td><input class="p-input" type="number" value="1499"></td></tr>
              <tr><td><strong>360° Tour</strong> / node</td><td><input class="p-input" type="number" value="599"></td><td><input class="p-input" type="number" value="1199"></td><td><input class="p-input" type="number" value="1999"></td></tr>
              <tr><td><strong>Fly-Through</strong> / video</td><td><input class="p-input" type="number" value="1499"></td><td><input class="p-input" type="number" value="2999"></td><td><input class="p-input" type="number" value="4999"></td></tr>
            </tbody></table>
            <div style="margin-top:16px;display:flex;gap:10px;align-items:center"><button class="btn-save" onclick="showToast('Pricing saved ✓','success')">Save Pricing</button><span style="font-size:12px;color:var(--muted)">Updates apply to all new quote requests instantly</span></div>
          </div>
          <div class="settings-panel" id="sp-notifications" style="display:none">
            <div class="sp-title">Notifications</div><div class="sp-sub">Control what triggers emails to you and your clients.</div>
            <div class="setting-row"><div><div class="sr-label">New order received</div><div class="sr-desc">Alert you when a floor plan order is placed</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">New quote request</div><div class="sr-desc">Alert you when a rendering quote is submitted</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">Client order confirmation</div><div class="sr-desc">Auto-send confirmation email to client</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">Draft ready for review</div><div class="sr-desc">Notify client when you upload a draft</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">Revision note received</div><div class="sr-desc">Alert you when a client leaves a revision note</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">Draft approved</div><div class="sr-desc">Alert you when a client approves a round</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
            <div class="setting-row"><div><div class="sr-label">Weekly digest</div><div class="sr-desc">Revenue and activity summary every Monday</div></div><button class="toggle" onclick="this.classList.toggle('on')"></button></div>
          </div>
          <div class="settings-panel" id="sp-integrations" style="display:none">
            <div class="sp-title">Integrations</div><div class="sp-sub">In production these live in environment variables — never exposed client-side. Paste here to configure.</div>
            <div class="setting-row"><div><div class="sr-label">Stripe Publishable Key</div><div class="sr-desc">Payments at checkout</div></div><input class="s-input" type="password" placeholder="pk_live_…"></div>
            <div class="setting-row"><div><div class="sr-label">Supabase Project URL</div><div class="sr-desc">Your project endpoint</div></div><input class="s-input" type="text" placeholder="https://xxx.supabase.co"></div>
            <div class="setting-row"><div><div class="sr-label">Supabase Anon Key</div><div class="sr-desc">Public key for client queries</div></div><input class="s-input" type="password" placeholder="eyJ…"></div>
            <div class="setting-row"><div><div class="sr-label">Resend API Key</div><div class="sr-desc">Transactional email delivery</div></div><input class="s-input" type="password" placeholder="re_…"></div>
            <div class="setting-row"><div><div class="sr-label">ReviewStudio Token</div><div class="sr-desc">Client annotation embed (future)</div></div><input class="s-input" type="text" placeholder="Embed token…"></div>
            <div style="margin-top:20px"><button class="btn-save" onclick="showToast('Keys saved ✓','success')">Save Keys</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ORDER MODAL -->
<div class="overlay" id="order-modal" onclick="closeOverlay('order-modal',event)">
  <div class="modal">
    <div class="m-header"><div><div class="m-ref" id="om-ref">—</div><div class="m-tag">Floor Plan Order</div></div><button class="m-close" onclick="closeOverlayDirect('order-modal')">×</button></div>
    <div class="m-body">
      <div class="m-sec"><div class="m-sec-title">Client</div><div class="d-grid"><div class="d-item"><div class="d-lbl">Name</div><div class="d-val" id="om-name">—</div></div><div class="d-item"><div class="d-lbl">Email</div><div class="d-val" id="om-email">—</div></div><div class="d-item full"><div class="d-lbl">Property Address</div><div class="d-val" id="om-address">—</div></div></div></div>
      <div class="m-sec"><div class="m-sec-title">Order Details</div><div class="d-grid"><div class="d-item"><div class="d-lbl">Floors</div><div class="d-val" id="om-floors">—</div></div><div class="d-item"><div class="d-lbl">Style</div><div class="d-val" id="om-style">—</div></div><div class="d-item"><div class="d-lbl">Total</div><div class="d-val p" id="om-total">—</div></div><div class="d-item"><div class="d-lbl">Deposit Paid</div><div class="d-val m" id="om-deposit">—</div></div><div class="d-item full"><div class="d-lbl">Add-ons</div><div class="d-val" id="om-addons">—</div></div></div></div>
      <div class="m-sec"><div class="m-sec-title">Client Notes</div><div class="m-notes" id="om-notes">—</div></div>
      <div class="m-sec"><div class="m-sec-title">Uploaded Files</div><div class="f-list" id="om-files"></div></div>
      <div class="m-sec"><div class="m-sec-title">Update Status</div><select class="status-select" id="om-status"><option>Received</option><option>Pending Invoice Approval</option><option>In Progress</option><option>In Review</option><option>Complete</option><option>On Hold</option></select></div>
    </div>
    <div class="m-footer"><button class="btn-cancel" onclick="closeOverlayDirect('order-modal')">Cancel</button><button class="btn-save" onclick="saveOrderStatus()">Save Changes</button></div>
  </div>
</div>

<!-- QUOTE MODAL -->
<div class="overlay" id="quote-modal" onclick="closeOverlay('quote-modal',event)">
  <div class="modal">
    <div class="m-header"><div><div class="m-ref" id="qm-ref">—</div><div class="m-tag">Rendering Quote Request</div></div><button class="m-close" onclick="closeOverlayDirect('quote-modal')">×</button></div>
    <div class="m-body">
      <div class="m-sec"><div class="m-sec-title">Client</div><div class="d-grid"><div class="d-item"><div class="d-lbl">Name</div><div class="d-val" id="qm-name">—</div></div><div class="d-item"><div class="d-lbl">Email</div><div class="d-val" id="qm-email">—</div></div><div class="d-item"><div class="d-lbl">Company</div><div class="d-val" id="qm-company">—</div></div><div class="d-item"><div class="d-lbl">Role</div><div class="d-val" id="qm-role">—</div></div></div></div>
      <div class="m-sec"><div class="m-sec-title">Project</div><div class="d-grid"><div class="d-item"><div class="d-lbl">Project Name</div><div class="d-val p" id="qm-project">—</div></div><div class="d-item"><div class="d-lbl">Type</div><div class="d-val" id="qm-type">—</div></div><div class="d-item"><div class="d-lbl">Location</div><div class="d-val" id="qm-city">—</div></div><div class="d-item"><div class="d-lbl">Buildings / Phases</div><div class="d-val" id="qm-phases">—</div></div><div class="d-item"><div class="d-lbl">Complexity</div><div class="d-val" id="qm-complexity">—</div></div><div class="d-item"><div class="d-lbl">Timeline</div><div class="d-val" id="qm-timeline">—</div></div></div></div>
      <div class="m-sec"><div class="m-sec-title">Renderings Requested</div><div id="qm-renders"></div></div>
      <div class="m-sec"><div class="m-sec-title">Reference Materials</div><div class="d-grid"><div class="d-item"><div class="d-lbl">Files Uploaded</div><div class="d-val" id="qm-files">—</div></div><div class="d-item"><div class="d-lbl">Shared Folder</div><div class="d-val" id="qm-link">—</div></div></div></div>
      <div class="m-sec"><div class="m-sec-title">Client Notes</div><div class="m-notes" id="qm-notes">—</div></div>
      <div class="m-sec"><div class="m-sec-title">Your Quote</div>
        <div class="q-editor"><div class="qe-lbl">Send Confirmed Quote to Client</div><div class="qe-row"><div class="qe-field"><label>Low ($)</label><input class="qe-input" type="number" id="qm-low" placeholder="e.g. 4500"></div><div class="qe-field"><label>High ($)</label><input class="qe-input" type="number" id="qm-high" placeholder="e.g. 6500"></div><button class="qe-send" onclick="sendConfirmedQuote()">Send →</button></div></div>
      </div>
      <div class="m-sec"><div class="m-sec-title">Update Status</div><div style="display:flex;gap:10px;align-items:center"><select class="status-select" id="qm-status"><option>Received</option><option>Quoted</option><option>Approved</option><option>On Hold</option><option>Declined</option></select><button class="btn-convert" onclick="convertQuoteToOrder()">Convert to Order</button></div></div>
    </div>
    <div class="m-footer"><button class="btn-cancel" onclick="closeOverlayDirect('quote-modal')">Cancel</button><button class="btn-save" onclick="saveQuoteStatus()">Save Changes</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ── SUPABASE SWAP-IN GUIDE ──────────────────────────────
// Once your Supabase project is created, replace the
// localStorage calls below with these async equivalents:
//
// import { createClient } from '@supabase/supabase-js'
// const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
//
// Load:  const { data } = await sb.from('orders').select('*').order('created_at',{ascending:false})
// Save:  await sb.from('orders').update({ status }).eq('ref', ref)
// Live:  sb.channel('orders').on('postgres_changes',{event:'INSERT',schema:'public',table:'orders'},
//          p => { orders.unshift(p.new); renderAll(); showToast('New order! ✓','success'); }).subscribe()
// ────────────────────────────────────────────────────────

const DEMO_ORDERS=[
  {ref:'FT-841022',date:'2025-02-10T09:23:00Z',floors:2,style:'Modern',addons:{'Furnished Version':79,'Rush Delivery':99},total:476,deposit:'238.00',address:'220 Riverside Drive, New York, NY 10025',notes:'Light oak flooring. Minimal furniture.',name:'Sarah Mitchell',email:'sarah.m@meridianre.com',company:'Meridian Real Estate',status:'In Review',files:['level1.pdf','level2.dwg']},
  {ref:'FT-392874',date:'2025-02-08T14:10:00Z',floors:1,style:'Luxury',addons:{'B&W Version':39},total:188,deposit:'94.00',address:'14 Kings Road, London, SW3 4PX',notes:'',name:'James Thornton',email:'j.thornton@studiov.co.uk',company:'Studio Volta',status:'Complete',files:['groundfloor.pdf']},
  {ref:'FT-774531',date:'2025-02-05T11:05:00Z',floors:3,style:'Scandinavian',addons:{},total:447,deposit:'223.50',address:'48 Elm Street, Austin, TX 78701',notes:'Three units — label each clearly.',name:'Priya Kessler',email:'priya@kesslergroup.com',company:'Kessler Group',status:'In Progress',files:['unitA.pdf','unitB.pdf','unitC.dwg']},
  {ref:'FT-203984',date:'2025-02-03T16:45:00Z',floors:1,style:'Traditional',addons:{'Extra View':49},total:198,deposit:'99.00',address:'7 Orchard Lane, Chicago, IL 60601',notes:'',name:"Michael O'Brien",email:'mobrien@obarchitects.com',company:"O'Brien Architects",status:'Received',files:['floorplan.pdf']},
];
const DEMO_QUOTES=[
  {ref:'QT-293847',date:'2025-02-14T10:30:00Z',project:'The Meridian Tower',type:'Multifamily Residential',city:'Austin, TX',phases:2,renders:{interior:{views:6},exterior:{views:3},aerial:{views:2}},complexity:'premium',timeline:'standard',estimateLow:7200,estimateHigh:11000,name:'Priya Kessler',email:'priya@kesslergroup.com',company:'Kessler Development',role:'Developer / Owner',totalFiles:8,sharedLink:'https://drive.google.com/...',notes:'Renders needed for Q2 sales launch.',status:'Received'},
  {ref:'QT-847291',date:'2025-02-12T15:20:00Z',project:'Harbor Walk Phase 2',type:'Mixed-Use Development',city:'Miami, FL',phases:3,renders:{exterior:{views:4},aerial:{views:2},flythrough:{views:1}},complexity:'luxury',timeline:'expedited',estimateLow:14000,estimateHigh:20000,name:'Elena Vasquez',email:'evasquez@pacificprops.com',company:'Pacific Properties',role:'Project Manager',totalFiles:12,sharedLink:'',notes:'Investor presentation in 6 weeks.',status:'Quoted'},
  {ref:'QT-556128',date:'2025-02-09T09:00:00Z',project:'Elm Street Residences',type:'Single Family Residential',city:'Chicago, IL',phases:1,renders:{interior:{views:4},exterior:{views:2}},complexity:'standard',timeline:'standard',estimateLow:2400,estimateHigh:3600,name:"Michael O'Brien",email:'mobrien@obarchitects.com',company:"O'Brien Architects",role:'Architect',totalFiles:5,sharedLink:'',notes:'',status:'Approved'},
];

let orders=[],quotes=[],curOrderRef=null,curQuoteRef=null,ordersF='all',quotesF='all';

const SUPABASE_URL = 'https://ompbigbvlsrlrqncfaag.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tcGJpZ2J2bHNybHJxbmNmYWFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NjAzMjEsImV4cCI6MjA4NzEzNjMyMX0.rlFyDdgeXHWmqbN_Pu3YHcbWoNqS_gdnuEEv4XyK9yM';

const SB_HEADERS = {
  'apikey': SUPABASE_KEY,
  'Authorization': `Bearer ${SUPABASE_KEY}`,
  'Content-Type': 'application/json'
};

async function loadData(){
  try {
    const [oRes, qRes] = await Promise.all([
      fetch(`${SUPABASE_URL}/rest/v1/orders?select=*&order=created_at.desc`, { headers: SB_HEADERS }),
      fetch(`${SUPABASE_URL}/rest/v1/quotes?select=*&order=created_at.desc`, { headers: SB_HEADERS })
    ]);
    const sbOrders = await oRes.json();
    const sbQuotes = await qRes.json();

    // Map Supabase column names to what the dashboard expects
    orders = Array.isArray(sbOrders) && sbOrders.length ? sbOrders.map(o => ({
      ref: o.ref,
      date: o.created_at,
      name: o.client_name,
      email: o.client_email,
      company: o.client_company || '',
      address: o.address,
      floors: o.floors,
      style: o.style,
      addons: o.addons || {},
      total: o.total,
      deposit: o.deposit,
      notes: o.notes || '',
      status: o.status,
      files: []
    })) : DEMO_ORDERS;

    quotes = Array.isArray(sbQuotes) && sbQuotes.length ? sbQuotes.map(q => ({
      ref: q.ref,
      date: q.created_at,
      name: q.client_name,
      email: q.client_email,
      company: q.client_company || '',
      role: q.client_role || '',
      project: q.project_name,
      type: q.project_type || '',
      city: q.city || '',
      phases: q.phases || 1,
      renders: q.renders || {},
      complexity: q.complexity || '',
      timeline: q.timeline || '',
      estimateLow: q.estimate_low,
      estimateHigh: q.estimate_high,
      totalFiles: q.total_files || 0,
      sharedLink: q.shared_link || '',
      notes: q.notes || '',
      status: q.status
    })) : DEMO_QUOTES;

  } catch(e) {
    console.warn('Supabase load failed, using localStorage fallback:', e);
    orders = JSON.parse(localStorage.getItem('ft_orders')||'null') || DEMO_ORDERS;
    quotes = JSON.parse(localStorage.getItem('ft_quotes')||'null') || DEMO_QUOTES;
  }
  renderAll();
}

async function saveData(){
  // Orders status update
  if(curOrderRef) {
    const o = orders.find(x => x.ref === curOrderRef);
    if(o) {
      await fetch(`${SUPABASE_URL}/rest/v1/orders?ref=eq.${curOrderRef}`, {
        method: 'PATCH',
        headers: { ...SB_HEADERS, 'Prefer': 'return=minimal' },
        body: JSON.stringify({ status: o.status })
      });
    }
  }
  if(curQuoteRef) {
    const q = quotes.find(x => x.ref === curQuoteRef);
    if(q) {
      await fetch(`${SUPABASE_URL}/rest/v1/quotes?ref=eq.${curQuoteRef}`, {
        method: 'PATCH',
        headers: { ...SB_HEADERS, 'Prefer': 'return=minimal' },
        body: JSON.stringify({ status: q.status, confirmed_low: q.estimateLow, confirmed_high: q.estimateHigh })
      });
    }
  }
  // Also sync to localStorage for offline fallback
  localStorage.setItem('ft_orders', JSON.stringify(orders));
  localStorage.setItem('ft_quotes', JSON.stringify(quotes));
}
function renderAll(){renderStats();renderOverview();renderOrdersTable();renderQuotesTable();renderClients();updateCounts();}

function renderStats(){
  const nO=orders.filter(o=>o.status==='Received').length;
  const nQ=quotes.filter(q=>q.status==='Received').length;
  const done=orders.filter(o=>o.status==='Complete').length;
  const rev=orders.reduce((s,o)=>s+parseFloat(o.deposit||0),0);
  set('s-orders',orders.length);set('s-quotes',quotes.length);set('s-complete',done);
  set('s-revenue','$'+rev.toLocaleString('en-US',{minimumFractionDigits:0}));
  set('s-orders-new',nO+' new');set('s-quotes-new',nQ+' new');
  set('rev-total','$'+rev.toLocaleString('en-US',{minimumFractionDigits:0}));
  const months=['Sep','Oct','Nov','Dec','Jan','Feb'];
  const vals=[1200,2400,1800,3200,2900,rev];
  const mx=Math.max(...vals);
  document.getElementById('rev-chart').innerHTML=vals.map((v,i)=>`<div class="rev-bar-wrap"><div class="rev-bar${i===5?' cur':''}" style="height:${Math.max(4,(v/mx)*64)}px"></div><div class="rev-lbl">${months[i]}</div></div>`).join('');
}

function renderOverview(){
  const rO=[...orders].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,4);
  document.getElementById('ov-orders').innerHTML=rO.length?rO.map(o=>`<div class="ov-item" onclick="openOrderModal('${o.ref}')"><div class="ov-ico ovi-p"><svg viewBox="0 0 16 16" fill="none" stroke="var(--purple-deep)" stroke-width="1.3" width="16"><rect x="2" y="2" width="12" height="12" rx="2"/><line x1="5" y1="6" x2="11" y2="6"/></svg></div><div class="ov-info"><div class="ov-name">${o.name}</div><div class="ov-sub">${o.ref} · ${o.address.split(',')[0]}</div></div><div class="ov-right"><div class="ov-amt">$${o.total}</div><div class="ov-date">${fmtDate(o.date)}</div></div></div>`).join(''):'<div style="font-size:13px;color:var(--muted);padding:10px 0">No orders yet</div>';
  const rQ=[...quotes].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,4);
  document.getElementById('ov-quotes').innerHTML=rQ.length?rQ.map(q=>`<div class="ov-item" onclick="openQuoteModal('${q.ref}')"><div class="ov-ico ovi-m"><svg viewBox="0 0 16 16" fill="none" stroke="var(--mint-deep)" stroke-width="1.3" width="16"><path d="M13 10a1 1 0 01-1 1H4l-2 2V4a1 1 0 011-1h9a1 1 0 011 1v6z"/></svg></div><div class="ov-info"><div class="ov-name">${q.project}</div><div class="ov-sub">${q.ref} · ${q.company}</div></div><div class="ov-right"><div class="ov-amt">$${(q.estimateLow||0).toLocaleString()}+</div><div class="ov-date">${fmtDate(q.date)}</div></div></div>`).join(''):'<div style="font-size:13px;color:var(--muted);padding:10px 0">No quotes yet</div>';
}

function renderOrdersTable(){
  const s=document.getElementById('orders-search').value.toLowerCase();
  const f=orders.filter(o=>(ordersF==='all'||o.status===ordersF)&&(!s||o.ref.toLowerCase().includes(s)||o.name.toLowerCase().includes(s)||o.address.toLowerCase().includes(s)));
  const tb=document.getElementById('orders-tbody');
  if(!f.length){tb.innerHTML=`<tr><td colspan="7">${emptyHTML('No Orders Found','Adjust your search or filter.')}</td></tr>`;return;}
  tb.innerHTML=f.map(o=>`<tr onclick="openOrderModal('${o.ref}')"><td><div class="td-ref">${o.ref}</div></td><td><div class="td-name">${o.name}</div><div class="td-sub">${o.email}</div></td><td><div class="td-muted">${o.floors} floor${o.floors>1?'s':''} · ${o.style}</div><div class="td-sub">${Object.keys(o.addons||{}).length?Object.keys(o.addons).join(', '):'No add-ons'}</div></td><td><span class="badge ${oBadge(o.status)}">${o.status}</span></td><td><div class="td-amt">$${o.total}<div class="sub">$${o.deposit} dep.</div></div></td><td><div class="td-muted">${fmtDate(o.date)}</div></td><td><button class="row-btn" onclick="event.stopPropagation();openOrderModal('${o.ref}')">Open →</button></td></tr>`).join('');
}

function renderQuotesTable(){
  const s=document.getElementById('quotes-search').value.toLowerCase();
  const rN={interior:'Interior',exterior:'Exterior',aerial:'Aerial','360':'360°',flythrough:'Fly-Through'};
  const f=quotes.filter(q=>(quotesF==='all'||q.status===quotesF)&&(!s||q.ref.toLowerCase().includes(s)||q.name.toLowerCase().includes(s)||q.project.toLowerCase().includes(s)||q.company.toLowerCase().includes(s)));
  const tb=document.getElementById('quotes-tbody');
  if(!f.length){tb.innerHTML=`<tr><td colspan="8">${emptyHTML('No Quote Requests','Submitted quotes appear here automatically.')}</td></tr>`;return;}
  tb.innerHTML=f.map(q=>{
    const tags=Object.keys(q.renders||{}).map(t=>`<span class="badge b-new" style="font-size:10px;padding:2px 8px">${rN[t]||t}</span>`).join(' ');
    const est=q.estimateLow?`$${q.estimateLow.toLocaleString()} – $${q.estimateHigh.toLocaleString()}`:'—';
    return `<tr onclick="openQuoteModal('${q.ref}')"><td><div class="td-ref">${q.ref}</div></td><td><div class="td-name">${q.name}</div><div class="td-sub">${q.company}</div></td><td><div class="td-name">${q.project}</div><div class="td-sub">${q.city}</div></td><td><div style="display:flex;flex-wrap:wrap;gap:4px">${tags||'—'}</div></td><td><div class="td-amt" style="font-size:12px">${est}</div></td><td><span class="badge ${qBadge(q.status)}">${q.status}</span></td><td><div class="td-muted">${fmtDate(q.date)}</div></td><td><button class="row-btn" onclick="event.stopPropagation();openQuoteModal('${q.ref}')">Open →</button></td></tr>`;
  }).join('');
}

function renderClients(){
  const s=document.getElementById('clients-search').value.toLowerCase();
  const map={};
  [...orders,...quotes].forEach(item=>{if(!map[item.email])map[item.email]={name:item.name,email:item.email,company:item.company||'',orders:0,quotes:0,rev:0};if(item.ref?.startsWith('FT')){map[item.email].orders++;map[item.email].rev+=parseFloat(item.deposit||0);}if(item.ref?.startsWith('QT'))map[item.email].quotes++;});
  const clients=Object.values(map).filter(c=>!s||c.name.toLowerCase().includes(s)||c.company.toLowerCase().includes(s)||c.email.toLowerCase().includes(s));
  const g=document.getElementById('clients-grid');
  if(!clients.length){g.innerHTML=`<div style="grid-column:1/-1">${emptyHTML('No Clients Yet','Clients are created automatically from orders and quotes.')}</div>`;return;}
  g.innerHTML=clients.map(c=>`<div class="cc"><div class="cc-top"><div class="cc-avatar">${c.name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase()}</div><div><div class="cc-name">${c.name}</div><div class="cc-co">${c.company||c.email}</div></div></div><div class="cc-stats"><div class="cc-stat"><div class="cc-stat-num">${c.orders}</div><div class="cc-stat-lbl">Orders</div></div><div class="cc-stat"><div class="cc-stat-num">${c.quotes}</div><div class="cc-stat-lbl">Quotes</div></div><div class="cc-stat"><div class="cc-stat-num">$${c.rev.toLocaleString('en-US',{minimumFractionDigits:0})}</div><div class="cc-stat-lbl">Revenue</div></div></div></div>`).join('');
}

function updateCounts(){
  const nO=orders.filter(o=>o.status==='Received').length;
  const nQ=quotes.filter(q=>q.status==='Received').length;
  const elO=document.getElementById('nc-orders'),elQ=document.getElementById('nc-quotes');
  elO.textContent=nO;elO.style.display=nO>0?'inline':'none';
  elQ.textContent=nQ;elQ.style.display=nQ>0?'inline':'none';
}

function openOrderModal(ref){
  const o=orders.find(x=>x.ref===ref);if(!o)return;curOrderRef=ref;
  set('om-ref',o.ref);set('om-name',o.name);set('om-email',o.email);set('om-address',o.address);
  set('om-floors',o.floors+' floor'+(o.floors>1?'s':''));set('om-style',o.style);
  set('om-total','$'+o.total);set('om-deposit','$'+o.deposit);
  set('om-addons',Object.keys(o.addons||{}).length?Object.entries(o.addons).map(([n,p])=>`${n} (+$${p})`).join(', '):'None');
  set('om-notes',o.notes||'No notes provided.');
  document.getElementById('om-status').value=o.status;
  document.getElementById('om-files').innerHTML=(o.files||[]).map(f=>`<div class="f-row"><span class="f-ext">${f.split('.').pop().toUpperCase()}</span><span class="f-name">${f}</span><button class="f-dl" onclick="showToast('Downloading…','')">↓</button></div>`).join('')||'<div style="font-size:13px;color:var(--muted)">No files.</div>';
  showOverlay('order-modal');
}

function openQuoteModal(ref){
  const q=quotes.find(x=>x.ref===ref);if(!q)return;curQuoteRef=ref;
  const rN={interior:'Interior',exterior:'Exterior',aerial:'Aerial','360':'360° Tour',flythrough:'Fly-Through'};
  set('qm-ref',q.ref);set('qm-name',q.name);set('qm-email',q.email);set('qm-company',q.company||'—');set('qm-role',q.role||'—');
  set('qm-project',q.project);set('qm-type',q.type||'—');set('qm-city',q.city||'—');
  set('qm-phases',q.phases+' building'+(q.phases>1?'s':''));
  set('qm-complexity',q.complexity?q.complexity[0].toUpperCase()+q.complexity.slice(1):'—');
  set('qm-timeline',{standard:'Standard (4–8 wks)',expedited:'Expedited (2–4 wks)',urgent:'Urgent (<2 wks)'}[q.timeline]||'—');
  document.getElementById('qm-renders').innerHTML='<div class="r-tags">'+Object.entries(q.renders||{}).map(([t,v])=>`<span class="r-tag">${rN[t]||t} × ${v.views} view${v.views>1?'s':''}</span>`).join('')+'</div>';
  set('qm-files',(q.totalFiles||0)+' files uploaded');
  document.getElementById('qm-link').innerHTML=q.sharedLink?`<a href="${q.sharedLink}" target="_blank" style="color:var(--purple-deep)">Open folder ↗</a>`:'None';
  set('qm-notes',q.notes||'No notes.');
  document.getElementById('qm-status').value=q.status;
  if(q.estimateLow)document.getElementById('qm-low').value=q.estimateLow;
  if(q.estimateHigh)document.getElementById('qm-high').value=q.estimateHigh;
  showOverlay('quote-modal');
}

function saveOrderStatus(){const o=orders.find(x=>x.ref===curOrderRef);if(o){o.status=document.getElementById('om-status').value;saveData();renderAll();}closeOverlayDirect('order-modal');showToast('Order updated ✓','success');}
function saveQuoteStatus(){const q=quotes.find(x=>x.ref===curQuoteRef);if(q){q.status=document.getElementById('qm-status').value;saveData();renderAll();}closeOverlayDirect('quote-modal');showToast('Quote updated ✓','success');}
function sendConfirmedQuote(){
  const low=document.getElementById('qm-low').value,high=document.getElementById('qm-high').value;
  if(!low||!high){showToast('Enter both low and high values','warn');return;}
  const q=quotes.find(x=>x.ref===curQuoteRef);
  if(q){q.status='Quoted';q.estimateLow=parseInt(low);q.estimateHigh=parseInt(high);saveData();renderAll();}
  closeOverlayDirect('quote-modal');showToast(`Quote $${parseInt(low).toLocaleString()} – $${parseInt(high).toLocaleString()} sent ✓`,'success');
}
function convertQuoteToOrder(){const q=quotes.find(x=>x.ref===curQuoteRef);if(!q)return;q.status='Approved';saveData();renderAll();closeOverlayDirect('quote-modal');showToast('Quote approved — client notified ✓','success');}

function showOverlay(id){document.getElementById(id).classList.add('show');document.body.style.overflow='hidden';}
function closeOverlay(id,e){if(e.target===document.getElementById(id))closeOverlayDirect(id);}
function closeOverlayDirect(id){document.getElementById(id).classList.remove('show');document.body.style.overflow='';}

function showView(v){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
  document.getElementById('view-'+v).classList.add('active');
  document.getElementById('nav-'+v).classList.add('active');
  const T={overview:['Overview',"Welcome back — here's what's happening today"],orders:['All Orders','Manage floor plan orders'],quotes:['Quote Requests','Review and respond to rendering inquiries'],clients:['Clients','Everyone who has worked with Floortype'],settings:['Settings & Pricing','Configure your account and rates']};
  set('tb-title',T[v][0]);set('tb-sub',T[v][1]);
}
function setFilter(btn,type){btn.parentElement.querySelectorAll('.fpill').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(type==='orders'){ordersF=btn.dataset.f;renderOrdersTable();}if(type==='quotes'){quotesF=btn.dataset.f;renderQuotesTable();}}
function showSP(panel,el){document.querySelectorAll('.settings-panel').forEach(p=>p.style.display='none');document.querySelectorAll('.sn-item').forEach(i=>i.classList.remove('active'));document.getElementById('sp-'+panel).style.display='block';el.classList.add('active');}
function exportCSV(){const cols=['Ref','Type','Name','Email','Company','Project/Address','Status','Amount','Date'];const rows=[...orders.map(o=>['Floor Plan',o.ref,o.name,o.email,o.company||'',o.address,o.status,'$'+o.total,fmtDate(o.date)]),...quotes.map(q=>['Quote',q.ref,q.name,q.email,q.company,q.project,q.status,q.estimateLow?`$${q.estimateLow}-${q.estimateHigh}`:'—',fmtDate(q.date)])];const csv=[cols,...rows].map(r=>r.map(c=>`"${c}"`).join(',')).join('\n');const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));a.download='floortype-export.csv';a.click();showToast('CSV exported ✓','success');}
function fmtDate(iso){return new Date(iso).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});}
function oBadge(s){return{Received:'b-recv','In Progress':'b-prog','In Review':'b-rev',Complete:'b-done','On Hold':'b-hold','Pending Invoice Approval':'b-inv'}[s]||'b-recv';}
function qBadge(s){return{Received:'b-new',Quoted:'b-qtd',Approved:'b-appr','On Hold':'b-hold',Declined:'b-hold'}[s]||'b-new';}
function emptyHTML(h,p){return`<div class="empty-state"><div class="empty-ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" width="22"><rect x="3" y="3" width="18" height="18" rx="3"/></svg></div><h3>${h}</h3><p>${p}</p></div>`;}
function set(id,val){const el=document.getElementById(id);if(el)el.textContent=val;}
function showToast(msg,type){const t=document.getElementById('toast');t.textContent=msg;t.className='toast'+(type?' '+type:'');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}

loadData();
setInterval(loadData,30000);
</script>
</body>
</html>